<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>集合函数风格查询 | easysql</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="类型安全的查询构造器，orm">
    
    <link rel="preload" href="/easysql-doc/assets/css/0.styles.e413b544.css" as="style"><link rel="preload" href="/easysql-doc/assets/js/app.043c89df.js" as="script"><link rel="preload" href="/easysql-doc/assets/js/2.ebde4dba.js" as="script"><link rel="preload" href="/easysql-doc/assets/js/15.16c963a1.js" as="script"><link rel="prefetch" href="/easysql-doc/assets/js/10.755206bb.js"><link rel="prefetch" href="/easysql-doc/assets/js/11.108365c7.js"><link rel="prefetch" href="/easysql-doc/assets/js/12.1019e624.js"><link rel="prefetch" href="/easysql-doc/assets/js/13.eaad68f3.js"><link rel="prefetch" href="/easysql-doc/assets/js/14.ebdb112e.js"><link rel="prefetch" href="/easysql-doc/assets/js/16.b981116c.js"><link rel="prefetch" href="/easysql-doc/assets/js/17.8b6320d9.js"><link rel="prefetch" href="/easysql-doc/assets/js/3.8dfc125c.js"><link rel="prefetch" href="/easysql-doc/assets/js/4.13b745f6.js"><link rel="prefetch" href="/easysql-doc/assets/js/5.54501c54.js"><link rel="prefetch" href="/easysql-doc/assets/js/6.45f8a5ad.js"><link rel="prefetch" href="/easysql-doc/assets/js/7.4e2227f1.js"><link rel="prefetch" href="/easysql-doc/assets/js/8.fc49f0b8.js"><link rel="prefetch" href="/easysql-doc/assets/js/9.27ab6d13.js">
    <link rel="stylesheet" href="/easysql-doc/assets/css/0.styles.e413b544.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/easysql-doc/" class="home-link router-link-active"><!----> <span class="site-name">easysql</span></a> <div class="links"><!----> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/easysql-doc/" aria-current="page" class="sidebar-link">概述</a></li><li><a href="/easysql-doc/introduction/" class="sidebar-link">入门</a></li><li><a href="/easysql-doc/metadata/" class="sidebar-link">元数据配置</a></li><li><a href="/easysql-doc/expr/" class="sidebar-link">表达式</a></li><li><a href="/easysql-doc/select/" class="sidebar-link">查询</a></li><li><a href="/easysql-doc/query/" aria-current="page" class="active sidebar-link">集合函数风格查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/easysql-doc/query/#创建查询" class="sidebar-link">创建查询</a></li><li class="sidebar-sub-header"><a href="/easysql-doc/query/#条件过滤" class="sidebar-link">条件过滤</a></li><li class="sidebar-sub-header"><a href="/easysql-doc/query/#投影" class="sidebar-link">投影</a></li><li class="sidebar-sub-header"><a href="/easysql-doc/query/#表连接" class="sidebar-link">表连接</a></li><li class="sidebar-sub-header"><a href="/easysql-doc/query/#分组" class="sidebar-link">分组</a></li><li class="sidebar-sub-header"><a href="/easysql-doc/query/#限制数量" class="sidebar-link">限制数量</a></li><li class="sidebar-sub-header"><a href="/easysql-doc/query/#排序" class="sidebar-link">排序</a></li><li class="sidebar-sub-header"><a href="/easysql-doc/query/#聚合的简写形式" class="sidebar-link">聚合的简写形式</a></li><li class="sidebar-sub-header"><a href="/easysql-doc/query/#exists" class="sidebar-link">exists</a></li><li class="sidebar-sub-header"><a href="/easysql-doc/query/#monadic查询" class="sidebar-link">monadic查询</a></li></ul></li><li><a href="/easysql-doc/jpa/" class="sidebar-link">JPA风格查询</a></li><li><a href="/easysql-doc/update/" class="sidebar-link">增删改</a></li><li><a href="/easysql-doc/native-sql/" class="sidebar-link">原生sql</a></li><li><a href="/easysql-doc/database/" class="sidebar-link">数据库交互</a></li><li><a href="/easysql-doc/nosql/" class="sidebar-link">nosql支持</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="集合函数风格查询"><a href="#集合函数风格查询" class="header-anchor">#</a> 集合函数风格查询</h1> <p>如果你更偏爱类似Scala的集合函数风格的查询方式，也可以使用集合高阶函数风格的api来创建查询：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">easysql<span class="token punctuation">.</span>dsl<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> q <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_<span class="token punctuation">.</span>id <span class="token operator">==</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>u <span class="token keyword">=&gt;</span> u<span class="token punctuation">.</span>id <span class="token operator">-&gt;</span> u<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
</code></pre></div><p>集合函数风格的api并不能使用全部的sql功能，如果你需要使用更多sql功能，或是需要动态创建查询，更推荐使用原生sql风格的api。</p> <h2 id="创建查询"><a href="#创建查询" class="header-anchor">#</a> 创建查询</h2> <p><code>query</code>方法用于创建一个查询：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">easysql<span class="token punctuation">.</span>dsl<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> q <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
</code></pre></div><p>创建完查询后，可以使用<code>sql</code>方法来生成一个sql语句，以mysql为例：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">easysql<span class="token punctuation">.</span>dsl<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> sql <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>sql<span class="token punctuation">(</span>DB<span class="token punctuation">.</span>MYSQL<span class="token punctuation">)</span>
</code></pre></div><p>生成的语句为：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>user_name<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span>
</code></pre></div><p>可以看到，<code>query</code>方法会自动展开实体类中定义的字段。</p> <h2 id="条件过滤"><a href="#条件过滤" class="header-anchor">#</a> 条件过滤</h2> <p>使用<code>filter</code>方法来配合前文介绍的表达式生成筛选条件：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">easysql<span class="token punctuation">.</span>dsl<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> sql <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_<span class="token punctuation">.</span>id <span class="token operator">==</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sql<span class="token punctuation">(</span>DB<span class="token punctuation">.</span>MYSQL<span class="token punctuation">)</span>
</code></pre></div><p>生成的sql为：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>user_name<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token number">1</span>
</code></pre></div><h2 id="投影"><a href="#投影" class="header-anchor">#</a> 投影</h2> <p>使用<code>map</code>方法来改变查询结果的类型：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">easysql<span class="token punctuation">.</span>dsl<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> q<span class="token operator">:</span> MonadicQuery<span class="token punctuation">[</span>Tuple1<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
</code></pre></div><p>可以看到，使用map之后，查询返回的类型会被改变，生成的sql如下（以mysql为例）：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span>
</code></pre></div><p>高阶函数<code>map</code>合法的返回类型有：<code>Expr</code>表达式，以及由表达式和<code>TableSchema</code>表组成的<code>Tuple</code>元组，比如：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">easysql<span class="token punctuation">.</span>dsl<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> q<span class="token operator">:</span> monadicQuery<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>u <span class="token keyword">=&gt;</span> u <span class="token operator">-&gt;</span> u<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
</code></pre></div><h2 id="表连接"><a href="#表连接" class="header-anchor">#</a> 表连接</h2> <p>使用<code>innerJoin</code>、<code>leftJoin</code>、<code>rightJoin</code>、<code>fullJoin</code>来创建表连接，上述方法都是柯里化的，可以在后面传入连接条件：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">easysql<span class="token punctuation">.</span>dsl<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> q <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span>innerJoin<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> a<span class="token punctuation">.</span>x <span class="token operator">==</span><span class="token operator">=</span> b<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
</code></pre></div><p>如果三张表join，连接条件中的参数类型就是三元组：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">easysql<span class="token punctuation">.</span>dsl<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> q <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span>innerJoin<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> a<span class="token punctuation">.</span>x <span class="token operator">==</span><span class="token operator">=</span> b<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">.</span>innerJoin<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> b<span class="token punctuation">.</span>y <span class="token operator">==</span><span class="token operator">=</span> c<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
</code></pre></div><p>以此类推。</p> <p>当然，也可以使用<code>map</code>来改变查询结果类型，不再赘述。</p> <p><code>query</code>中可以给表起别名，来处理自连接：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">easysql<span class="token punctuation">.</span>dsl<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> q <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>a as <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerJoin<span class="token punctuation">(</span>a as <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> t1<span class="token punctuation">.</span>x <span class="token operator">==</span><span class="token operator">=</span> t2<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
</code></pre></div><h2 id="分组"><a href="#分组" class="header-anchor">#</a> 分组</h2> <p>使用<code>groupBy</code>创建分组：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">easysql<span class="token punctuation">.</span>dsl<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> q <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span>_<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
</code></pre></div><p>我们需要用<code>map</code>来配合聚合函数表达式简化返回类型：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">easysql<span class="token punctuation">.</span>dsl<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> q <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span>_<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>u <span class="token keyword">=&gt;</span> u<span class="token punctuation">.</span>name <span class="token operator">-&gt;</span> sum<span class="token punctuation">(</span>u<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="限制数量"><a href="#限制数量" class="header-anchor">#</a> 限制数量</h2> <p>使用<code>drop</code>和<code>take</code>限制结果集数量：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">easysql<span class="token punctuation">.</span>dsl<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> q <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>take<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="排序"><a href="#排序" class="header-anchor">#</a> 排序</h2> <p>使用<code>sortBy</code>添加排序：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">easysql<span class="token punctuation">.</span>dsl<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> q <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>sortBy<span class="token punctuation">(</span>_<span class="token punctuation">.</span>id<span class="token punctuation">.</span>asc<span class="token punctuation">)</span><span class="token punctuation">.</span>sortBy<span class="token punctuation">(</span>_<span class="token punctuation">.</span>name<span class="token punctuation">.</span>desc<span class="token punctuation">)</span>
</code></pre></div><h2 id="聚合的简写形式"><a href="#聚合的简写形式" class="header-anchor">#</a> 聚合的简写形式</h2> <p>我们想查询一个聚合后的结果，固然可以使用聚合函数类型的表达式：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">easysql<span class="token punctuation">.</span>dsl<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> q <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>u <span class="token keyword">=&gt;</span> count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>但这可能不太方便，我们可以这样来简写：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">easysql<span class="token punctuation">.</span>dsl<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> count <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>size
<span class="token keyword">val</span> sum <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span>_<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
<span class="token keyword">val</span> max <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span>_<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
<span class="token keyword">val</span> min <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>min<span class="token punctuation">(</span>_<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
<span class="token keyword">val</span> avg <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>avg<span class="token punctuation">(</span>_<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
</code></pre></div><h2 id="exists"><a href="#exists" class="header-anchor">#</a> exists</h2> <p>对于单字段查询，我们可以使用<code>exists</code>方法来生成查询结果是否存在的sql：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">easysql<span class="token punctuation">.</span>dsl<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> q <span class="token operator">=</span> monadicQuery<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_<span class="token punctuation">.</span>id <span class="token operator">&gt;</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span>exists
</code></pre></div><p>生成的sql为：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span>
    <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span>
    <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token operator">&gt;</span> <span class="token number">10000</span>
<span class="token punctuation">)</span>
</code></pre></div><h2 id="monadic查询"><a href="#monadic查询" class="header-anchor">#</a> monadic查询</h2> <p>集合函数风格的api实现了<code>map</code>、<code>withFilter</code>、<code>flatMap</code>，因此，在内连接表的情况下，我们也可以使用<code>for</code>表达式来创建查询：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">easysql<span class="token punctuation">.</span>dsl<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> q <span class="token operator">=</span> <span class="token keyword">for</span> <span class="token punctuation">{</span>
    u <span class="token keyword">&lt;-</span> monadicQuery<span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token keyword">if</span> u<span class="token punctuation">.</span>name <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span>
    p <span class="token keyword">&lt;-</span> monadicQuery<span class="token punctuation">(</span>post<span class="token punctuation">)</span> <span class="token keyword">if</span> u<span class="token punctuation">.</span>id <span class="token operator">==</span><span class="token operator">=</span> post<span class="token punctuation">.</span>userId
<span class="token punctuation">}</span> <span class="token keyword">yield</span> <span class="token punctuation">(</span>u<span class="token punctuation">,</span> p<span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/easysql-doc/select/" class="prev">
        查询
      </a></span> <span class="next"><a href="/easysql-doc/jpa/">
        JPA风格查询
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/easysql-doc/assets/js/app.043c89df.js" defer></script><script src="/easysql-doc/assets/js/2.ebde4dba.js" defer></script><script src="/easysql-doc/assets/js/15.16c963a1.js" defer></script>
  </body>
</html>
